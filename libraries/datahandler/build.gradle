/*
* Copyright BMW CarIT GmbH, 2022.
*
* This program and the accompanying materials are made
* available under the terms of the Eclipse Public License 2.0
* which is available at https://www.eclipse.org/legal/epl-2.0/
*
* SPDX-License-Identifier: EPL-2.0
*/

plugins {
    id "biz.aQute.bnd.builder"
    id 'org.eclipse.sw360.java-conventions'
    id "org.jruyi.thrift"
    id 'java-library'
}

dependencies {
    compileOnly libs.annotations
    compileOnly libs.findbugs.annotations
    implementation libs.cloudant.client
    implementation libs.commons.codec
    implementation libs.commons.csv
    implementation libs.commons.io
    implementation libs.ektorp
    implementation libs.ektorplucene
    implementation libs.guava
    implementation libs.failureaccess
    implementation libs.httpcore
    implementation libs.jackson.annotations
    implementation libs.jackson.core
    implementation libs.jackson.databind
    implementation libs.libthrift
    implementation libs.log4j.api
    implementation libs.log4j.core
    implementation libs.slf4j.api
    runtimeOnly libs.log4j.jcl
    runtimeOnly libs.log4j.slf4j.impl
    testImplementation libs.hamcrest.all
    testImplementation libs.jgiven.junit
    testImplementation libs.junit
    testImplementation libs.junit.dataprovider
    testImplementation libs.mockito.all
}

description = 'datahandler'
tasks.build.dependsOn(deployJar)
tasks.deployJar.dependsOn(jar)


tasks.register('testsJar', Jar) {
    archiveClassifier = 'tests'
    from(sourceSets.test.output)
}

compileThrift {
    Set<File> files = new HashSet<>()
    files.add(file("src/test/thrift/test.thrift"))
    sourceItems += files
    outputDir = file('build/generated-sources/thrift')
    createGenFolder = false
}

sourceSets {
    main.java.srcDirs += 'build/generated-sources/thrift'
}

publishing.publications.maven.artifact(testsJar)
